<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ¥è®“é¢è©¦å®˜ç™¼ç¾æˆ‘æ˜¯ä¸€éš»ä¼éµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=VT323&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            overflow: hidden;
            background-color: #1a202c;
            color: white;
            user-select: none;
        }

        #game-canvas {
            background: linear-gradient(to bottom, #f0f4f8 0%, #d9e2ec 100%);
            box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
            cursor: none; /* Hide default cursor */
        }

        .terminal-text {
            font-family: 'VT323', monospace;
            text-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
        }

        .pixel-font {
            font-family: 'VT323', monospace;
        }

        #ui-layer {
            pointer-events: none; /* Let clicks pass through to game logic if needed */
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative">

    <!-- Start Screen -->
    <div id="start-screen" class="absolute z-50 bg-gray-900 bg-opacity-95 w-full h-full flex flex-col items-center justify-center text-center p-4">
        <h1 class="text-6xl font-bold mb-4 text-yellow-400">ğŸ§ åˆ¥è®“é¢è©¦å®˜ç™¼ç¾æˆ‘æ˜¯ä¸€éš»ä¼éµ</h1>
        <div class="bg-gray-800 p-6 rounded-lg border-2 border-gray-600 max-w-2xl">
            <p class="text-xl mb-6">ä½ æ˜¯ <span class="font-bold text-blue-300">Pingu++</span>ï¼Œä¸€éš»å½è£æˆé«˜ç´šå·¥ç¨‹å¸«çš„ä¼éµã€‚</p>
            <ul class="text-left space-y-4 mb-8 text-lg">
                <li>â±ï¸ <strong>ä¿æŒæ´»èº</strong>ï¼šå¦‚æœä¸ç§»å‹•æ»‘é¼ æˆ–æ‰“å­—ï¼Œ<strong>10ç§’å¾Œå°±æœƒæ»‘è½</strong>ï¼</li>
                <li>âŒ¨ï¸ <strong>ç‹‚æŒ‰ä»»æ„éµ</strong>ï¼šå‡è£åœ¨å¯« Code å›ç­”é¢è©¦å®˜çš„å•é¡Œã€‚</li>
                <li>ğŸ–±ï¸ <strong>ç§»å‹•æ»‘é¼ </strong>ï¼šç¨å¾®å‹•ä¸€ä¸‹å°±èƒ½é‡ç½®æ»‘è½å€’æ•¸ã€‚</li>
                <li>ğŸŸ <strong>ç©ºç™½éµ (Space)</strong>ï¼šé‡åˆ°é›£é¡Œæ™‚ï¼Œåå‡ºä¸€æ¢é­šè½‰ç§»æ³¨æ„åŠ› (é™ 3 æ¬¡)ã€‚</li>
            </ul>
            <button onclick="startGame()" class="px-8 py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded text-2xl shadow-lg transform transition hover:scale-105">
                é–‹å§‹é¢è©¦ (ç›®æ¨™ï¼šå›ç­” 5 é¡Œ)
            </button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="game-over-screen" class="hidden absolute z-50 bg-red-900 bg-opacity-95 w-full h-full flex flex-col items-center justify-center text-center p-4">
        <h1 class="text-6xl font-bold mb-4 text-white">é¢è©¦å¤±æ•—</h1>
        <p id="death-reason" class="text-3xl text-yellow-300 mb-8 font-bold">åŸå› ...</p>
        <p id="final-score" class="text-xl text-white mb-8">æˆåŠŸå›ç­”äº† 0 å€‹å•é¡Œ</p>
        <button onclick="location.reload()" class="px-8 py-4 bg-white text-red-900 font-bold rounded text-xl shadow-lg hover:bg-gray-200">
            å†è©¦ä¸€æ¬¡ (æŠ•éå±¥æ­·)
        </button>
    </div>

    <!-- Victory Screen -->
    <div id="game-win-screen" class="hidden absolute z-50 bg-green-900 bg-opacity-95 w-full h-full flex flex-col items-center justify-center text-center p-4">
        <h1 class="text-6xl font-bold mb-4 text-white">ğŸ‰ é¢è©¦é€šéï¼ ğŸ‰</h1>
        <p class="text-3xl text-yellow-300 mb-8 font-bold">ä½ è¢«éŒ„å–äº†ï¼</p>
        <p class="text-xl text-white mb-8">é›–ç„¶ä»–å€‘è¦ºå¾—ä½ æ€ªæ€ªçš„ï¼Œä½†ä½ çš„æ‰‹é€Ÿå¤ªé©šäººäº†ã€‚</p>
        <p class="text-lg text-gray-200 mb-8">è·ä½ï¼šé¦–å¸­åƒé­šå·¥ç¨‹å¸« (Chief Fish Officer)</p>
        <button onclick="location.reload()" class="px-8 py-4 bg-white text-green-900 font-bold rounded text-xl shadow-lg hover:bg-gray-200">
            å†æ¬¡é¢è©¦ (æŒ‘æˆ°æ›´é«˜è–ª)
        </button>
    </div>

    <!-- UI Overlay -->
    <div id="ui-layer" class="absolute top-0 left-0 w-full h-full p-4 flex flex-col justify-between z-10 hidden">
        
        <!-- Top Stats -->
        <div class="flex justify-between items-start w-full">
            <!-- Suspicion Meter (Controlled by inactivity mainly now) -->
            <div class="w-1/3 bg-gray-800 bg-opacity-80 p-3 rounded border border-gray-600">
                <div class="flex justify-between mb-1">
                    <span class="text-sm font-bold text-red-300">é¢è©¦å®˜æ‡·ç–‘åº¦</span>
                    <span id="suspicion-text">0%</span>
                </div>
                <div class="w-full bg-gray-700 h-4 rounded overflow-hidden">
                    <div id="suspicion-bar" class="h-full bg-red-500 transition-all duration-200" style="width: 0%"></div>
                </div>
            </div>

            <!-- Question Box -->
            <div class="w-1/3 text-center">
                <div class="bg-white text-black p-4 rounded-lg shadow-xl border-b-4 border-gray-300 relative">
                    <div class="absolute -bottom-2 left-1/2 w-4 h-4 bg-white transform -translate-x-1/2 rotate-45"></div>
                    <p class="text-xs text-gray-500 uppercase tracking-widest mb-1">é¢è©¦å®˜ Question</p>
                    <p id="question-text" class="text-lg font-bold">è«‹è‡ªæˆ‘ä»‹ç´¹ä¸¦è§£é‡‹ç‚ºä»€éº¼ä½ æ²’æœ‰ç©¿è¤²å­ï¼Ÿ</p>
                </div>
            </div>

            <!-- Idle/Slip Timer (Replaces Instinct) -->
            <div class="w-1/3 bg-gray-800 bg-opacity-80 p-3 rounded border border-gray-600 flex flex-col items-end">
                <div class="flex justify-between mb-1 w-full text-right">
                    <span class="text-sm font-bold text-yellow-300 w-full">âš ï¸ æ»‘è½è­¦å ± (10s)</span>
                    <span id="idle-text" class="text-sm font-mono text-white">0.0s</span>
                </div>
                <div class="w-full bg-gray-700 h-6 rounded overflow-hidden relative border border-gray-500">
                    <!-- Ticks for seconds -->
                    <div class="absolute top-0 left-0 w-full h-full flex justify-between px-1 pointer-events-none z-10 opacity-30">
                        <div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div>
                        <div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div><div class="w-px h-full bg-black"></div>
                    </div>
                    <div id="instinct-bar" class="h-full bg-yellow-400 transition-all duration-75" style="width: 0%"></div>
                    <div class="absolute top-0 left-0 w-full h-full flex justify-center items-center">
                        <span class="text-xs text-black font-bold opacity-70">å‹•ä¸€å‹•æ»‘é¼ æˆ–éµç›¤ï¼</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fish Ammo -->
        <div class="absolute top-24 right-4 flex flex-col items-end">
            <span class="text-sm font-bold mb-1 shadow-black drop-shadow-md">ç·Šæ€¥èª˜é¤Œ (Space)</span>
            <div id="fish-container" class="text-3xl">ğŸŸ ğŸŸ ğŸŸ</div>
        </div>

        <!-- Middle: Code Output -->
        <div class="absolute top-1/2 left-4 transform -translate-y-1/2 w-64 h-64 bg-black opacity-80 rounded p-2 overflow-hidden border border-green-500 terminal-text text-green-400 text-sm">
            <div id="code-display" class="w-full h-full flex flex-col justify-end whitespace-pre-wrap break-all">
                // System Initialized...
                // Waiting for input...
            </div>
        </div>

        <!-- Bottom: Progress -->
        <div class="w-full flex flex-col items-center mb-4">
            <div class="w-2/3 bg-gray-900 p-2 rounded-full border-2 border-blue-500 relative">
                <div id="answer-bar" class="h-6 bg-blue-500 rounded-full transition-all duration-75" style="width: 0%"></div>
                <p class="absolute top-0 left-0 w-full h-full flex justify-center items-center text-sm font-bold text-white shadow-black drop-shadow-md">
                    å›ç­”é€²åº¦ (ç‹‚æŒ‰éµç›¤!)
                </p>
            </div>
        </div>
    </div>

    <!-- Canvas Layer -->
    <canvas id="game-canvas" class="rounded shadow-2xl"></canvas>

    <script>
        // --- Game Configuration & State ---
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'START'; // START, PLAYING, GAMEOVER
        let width, height;
        let lastTime = 0;

        // Mechanics
        let balance = 0; // Visual only now
        let realMouseX = 0; 
        let realMouseY = 0; 
        
        let suspicion = 0; // 0 to 100
        let idleTimer = 0; // 0 to 10 seconds
        const MAX_IDLE_TIME = 10.0;

        let answerProgress = 0; // 0 to 100
        let fishCount = 3;
        let score = 0; // Questions answered

        // Content
        const questions = [
            "è§£é‡‹ç‚ºä»€éº¼æˆ‘å€‘è¦éŒ„å–ä¸€éš»...å‘ƒï¼ŒéŒ„å–ä½ ï¼Ÿ",
            "å¦‚ä½•åè½‰ä¸€å€‹äºŒå…ƒæ¨¹ï¼Ÿè«‹ç”¨ç™½æ¿ç­†å¯«åœ¨è¢å¹•ä¸Šã€‚",
            "ä½ å°å—æ¥µæ´²çš„é›²ç«¯ä¼ºæœå™¨æ¶æ§‹æœ‰ä»€éº¼çœ‹æ³•ï¼Ÿ",
            "é€™æ®µ COBOL ç¨‹å¼ç¢¼ç‚ºä»€éº¼æœƒæœ‰é­šè…¥å‘³ï¼Ÿ",
            "å¦‚æœä½ çš„åŒäº‹æ˜¯æµ·è±¹ï¼Œä½ è©²å¦‚ä½•èˆ‡ä»–å”ä½œï¼Ÿ",
            "è«‹å„ªåŒ–é€™å€‹ O(n^2) çš„æ¼”ç®—æ³•ï¼Œä¸ç„¶æ²’åˆé¤åƒã€‚",
            "ç‚ºä»€éº¼ä½ çš„éµç›¤ä¸Šå…¨æ˜¯æ°´æ¼¬ï¼Ÿ",
            "è§£é‡‹ Kubernetesï¼Œå‡è¨­æˆ‘æ˜¯ä¸€éš»å¸ç‹ä¼éµã€‚",
            "ä½ çš„è¥¿è£ä¼¼ä¹... å’Œèº«é«”é•·åœ¨ä¸€èµ·ï¼Ÿ",
            "æˆ‘å€‘å…¬å¸å¯¦è¡Œ 996ï¼Œä½†ä½ æ˜¯å¤œè¡Œæ€§å‹•ç‰©å—ï¼Ÿ",
            "å¦‚ä½•åœ¨ä¸ä½¿ç”¨æ»‘é¼ çš„æƒ…æ³ä¸‹æ•ç²... éŒ¯èª¤ï¼Ÿ"
        ];
        
        const codeSnippets = [
            "import fish;",
            "details.slide(belly);",
            "if (hungry) { eat(sushi); }",
            "public void nootNoot() {}",
            "try { fly(); } catch (GravityError e) {}",
            "while(ice_is_melting) { panic(); }",
            "const suit = 'natural_feathers';",
            "sudo apt-get install herring",
            "git push origin antarctica",
            "var wiggle = true;",
            "// TODO: Hide beak",
            "console.log('Squawk!');"
        ];

        let currentQuestion = "";
        let codeLines = ["// Ready for interview..."];

        // Sprites/Visuals placeholders
        const penguinColor = '#333';
        const bellyColor = '#fff';
        const suitColor = '#1a202c';
        
        // --- Initialization ---
        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('game-over-screen').classList.add('hidden');
            document.getElementById('game-win-screen').classList.add('hidden');
            document.getElementById('ui-layer').classList.remove('hidden');
            
            gameState = 'PLAYING';
            resetGame();
            lastTime = performance.now();
            requestAnimationFrame(gameLoop);
        }

        function resetGame() {
            balance = 0;
            suspicion = 0;
            idleTimer = 0;
            answerProgress = 0;
            fishCount = 3;
            score = 0;
            codeLines = ["// Interview Start"];
            nextQuestion();
            updateUI();
        }

        function nextQuestion() {
            currentQuestion = questions[Math.floor(Math.random() * questions.length)];
            document.getElementById('question-text').innerText = currentQuestion;
            answerProgress = 0;
        }

        // --- Input Handling ---
        function resetIdle() {
            if (gameState === 'PLAYING') {
                idleTimer = 0; // Reset timer on activity
            }
        }

        window.addEventListener('mousemove', (e) => {
            if (gameState !== 'PLAYING') return;
            realMouseX = e.clientX;
            realMouseY = e.clientY;
            resetIdle();
        });

        window.addEventListener('keydown', (e) => {
            if (gameState !== 'PLAYING') return;
            resetIdle();

            // Spacebar = Fish
            if (e.code === 'Space') {
                e.preventDefault();
                throwFish();
                return;
            }

            // Any other key = Typing Code
            typeCode();
        });

        function typeCode() {
            answerProgress += 4 + Math.random() * 3;
            if (answerProgress >= 100) {
                answerProgress = 0;
                score++;
                
                // Win Condition: 5 Questions
                if (score >= 5) {
                    gameWin();
                    return;
                }

                // ä¿®æ”¹ï¼šæˆåŠŸå›ç­”å•é¡Œæœƒé™ä½æ‡·ç–‘åº¦ï¼Œçå‹µç©å®¶
                suspicion = Math.max(0, suspicion - 20); 
                triggerFeedback("Correct!", width/2, height/2 - 100, "green");
                triggerFeedback("æ‡·ç–‘åº¦ä¸‹é™!", width/2, height/2 - 150, "blue");
                nextQuestion();
            }

            const snippet = codeSnippets[Math.floor(Math.random() * codeSnippets.length)];
            const gibberish = Math.random().toString(36).substring(7);
            
            codeLines.push(Math.random() > 0.7 ? snippet : `> ${gibberish}`);
            if (codeLines.length > 12) codeLines.shift();
            
            updateCodeDisplay();
        }

        function throwFish() {
            if (fishCount > 0) {
                fishCount--;
                suspicion = Math.max(0, suspicion - 40); 
                idleTimer = 0; // Also resets idle
                triggerFeedback("ğŸŸ é­šé¤Œæˆ°è¡“!", width/2, height/2, "blue");
                createParticle(width/2, height/2, 'ğŸŸ');
                updateUI();
            } else {
                triggerFeedback("æ²’é­šäº†!", width/2, height/2, "red");
            }
        }

        function updateCodeDisplay() {
            document.getElementById('code-display').innerText = codeLines.join('\n');
        }

        // --- Game Logic ---
        function update(dt) {
            // Increase idle timer
            idleTimer += dt / 1000;

            // Visual balance calculation (Wobble increases as timer fills)
            // 0s = stable. 9s = very wobbly.
            let wobbleIntensity = (idleTimer / MAX_IDLE_TIME) * 45; // Max 45 degrees
            balance = Math.sin(Date.now() / 200) * wobbleIntensity;

            // Suspicion rises slowly over time
            suspicion += 1 * (dt / 1000);

            // Win/Loss Checks
            if (idleTimer >= MAX_IDLE_TIME) {
                gameOver("ç™¼å‘†å¤ªä¹…ï¼Œå¾æ¤…å­ä¸Šæ»‘ä¸‹å»äº†ï¼");
            }
            if (suspicion >= 100) {
                gameOver("é¢è©¦å®˜è­˜ç ´äº†ä½ çš„å½è£ã€‚");
            }

            updateUI();
        }

        function updateUI() {
            document.getElementById('suspicion-bar').style.width = `${Math.min(100, suspicion)}%`;
            document.getElementById('suspicion-text').innerText = `${Math.floor(suspicion)}%`;
            
            // Idle Timer UI
            let idlePercent = (idleTimer / MAX_IDLE_TIME) * 100;
            document.getElementById('instinct-bar').style.width = `${Math.min(100, idlePercent)}%`;
            // Change color based on urgency
            let barColor = idleTimer > 7 ? 'bg-red-500' : (idleTimer > 4 ? 'bg-yellow-400' : 'bg-green-400');
            document.getElementById('instinct-bar').className = `h-full transition-all duration-75 ${barColor}`;
            document.getElementById('idle-text').innerText = idleTimer.toFixed(1) + "s";

            document.getElementById('answer-bar').style.width = `${Math.min(100, answerProgress)}%`;
            let fishStr = "";
            for(let i=0; i<fishCount; i++) fishStr += "ğŸŸ ";
            document.getElementById('fish-container').innerText = fishStr;
        }

        function gameOver(reason) {
            gameState = 'GAMEOVER';
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('game-over-screen').classList.remove('hidden');
            document.getElementById('death-reason').innerText = reason;
            document.getElementById('final-score').innerText = `ä½ æˆåŠŸå›ç­”äº† ${score} å€‹å•é¡Œï¼Œä½†çŸ½è°·ä¸é©åˆä¼éµã€‚`;
        }

        function gameWin() {
            gameState = 'GAMEOVER';
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('game-win-screen').classList.remove('hidden');
        }

        // --- Rendering ---
        function draw(ctx) {
            ctx.clearRect(0, 0, width, height);

            // Draw Office Background
            ctx.fillStyle = '#e2e8f0';
            ctx.fillRect(0, height * 0.6, width, height * 0.4); 
            
            // Draw Desk
            ctx.fillStyle = '#718096';
            ctx.fillRect(width * 0.1, height * 0.6, width * 0.8, height * 0.4);
            
            // Draw Interviewer
            ctx.fillStyle = '#2d3748';
            ctx.beginPath();
            ctx.arc(width * 0.5, height * 0.4, 60, 0, Math.PI * 2); 
            ctx.fill();
            ctx.fillRect(width * 0.4, height * 0.4, width * 0.2, height * 0.2);
            ctx.fillStyle = 'rgba(255,255,255,0.1)';
            ctx.font = '20px Arial';
            ctx.fillText("ğŸ‘€", width * 0.5 - 10, height * 0.4);

            // Penguin Setup
            ctx.save();
            let anchorX = width / 2;
            let anchorY = height * 0.75;
            ctx.translate(anchorX, anchorY); 
            
            let rotation = (balance * Math.PI) / 180;
            ctx.rotate(rotation);

            drawPenguin(ctx);
            
            // Draw Warning Signs if Idle is high
            if (idleTimer > 7) {
                // Shake effect is handled by balance wobble, adding visual sweat
                ctx.fillStyle = 'rgba(255,0,0,0.5)';
                ctx.font = '30px Arial';
                ctx.fillText("!!!", 0, -150);
            }

            ctx.restore(); // Restore to world space

            // Draw Mouse Cursor Visual (to encourage movement)
            if (idleTimer > 2) {
                ctx.beginPath();
                ctx.arc(realMouseX, realMouseY, 5 + (idleTimer*2), 0, Math.PI*2);
                ctx.strokeStyle = `rgba(255, 0, 0, ${idleTimer/10})`;
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Draw Feedback Particles
            updateAndDrawParticles(ctx);

            // Screen Red overlay on danger
            if (idleTimer > 8) {
                ctx.fillStyle = `rgba(255, 0, 0, ${(idleTimer-8)/4})`;
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = "white";
                ctx.font = "bold 40px 'Noto Sans TC'";
                ctx.textAlign = "center";
                ctx.fillText("å¿«å‹•å•Šï¼ï¼ï¼", width/2, height/2 - 200);
            }
        }

        function drawPenguin(ctx) {
            const s = 1.5;
            // Chair
            ctx.fillStyle = '#4a5568';
            ctx.fillRect(-60*s, 140*s, 120*s, 20*s); 
            ctx.fillRect(-10*s, 80*s, 20*s, 60*s); 

            // Body
            ctx.fillStyle = penguinColor;
            ctx.beginPath();
            ctx.ellipse(0, 0, 70*s, 100*s, 0, 0, Math.PI * 2);
            ctx.fill();

            // Belly
            ctx.fillStyle = bellyColor;
            ctx.beginPath();
            ctx.ellipse(0, 10*s, 45*s, 75*s, 0, 0, Math.PI * 2);
            ctx.fill();

            // Jacket
            ctx.fillStyle = suitColor;
            ctx.beginPath();
            ctx.moveTo(-70*s, -20*s);
            ctx.quadraticCurveTo(-30*s, 20*s, -40*s, 100*s);
            ctx.lineTo(-70*s, 50*s);
            ctx.fill();
            ctx.beginPath();
            ctx.moveTo(70*s, -20*s);
            ctx.quadraticCurveTo(30*s, 20*s, 40*s, 100*s);
            ctx.lineTo(70*s, 50*s);
            ctx.fill();

            // Tie
            ctx.fillStyle = '#e53e3e';
            ctx.beginPath();
            ctx.moveTo(0, -30*s);
            ctx.lineTo(-10*s, 60*s);
            ctx.lineTo(0, 70*s);
            ctx.lineTo(10*s, 60*s);
            ctx.fill();

            // Face
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(-20*s, -60*s, 15*s, 0, Math.PI * 2); 
            ctx.arc(20*s, -60*s, 15*s, 0, Math.PI * 2); 
            ctx.fill();

            // Pupils
            ctx.fillStyle = 'black';
            // Eyes follow mouse if not idle, else go crazy
            let eyeX = (realMouseX - width/2) / 30;
            let eyeY = (realMouseY - height/2) / 30;
            if (idleTimer > 5) {
                eyeX = (Math.random()-0.5) * 10;
                eyeY = (Math.random()-0.5) * 10;
            }

            ctx.beginPath();
            ctx.arc(-20*s + Math.max(-10, Math.min(10, eyeX)), -60*s + Math.max(-10, Math.min(10, eyeY)), 5*s, 0, Math.PI * 2);
            ctx.arc(20*s + Math.max(-10, Math.min(10, eyeX)), -60*s + Math.max(-10, Math.min(10, eyeY)), 5*s, 0, Math.PI * 2);
            ctx.fill();

            // Beak
            ctx.fillStyle = '#ecc94b';
            ctx.beginPath();
            ctx.moveTo(-10*s, -50*s);
            ctx.lineTo(10*s, -50*s);
            ctx.lineTo(0, -35*s);
            ctx.fill();

            // Flippers
            ctx.fillStyle = penguinColor;
            
            // Animate flippers if typing
            let leftArmRot = Math.PI / 4;
            let rightArmRot = -Math.PI / 4;
            
            if (Date.now() - lastTypingTime < 200) {
                 leftArmRot += Math.sin(Date.now() / 50) * 0.2;
                 rightArmRot -= Math.sin(Date.now() / 50) * 0.2;
            }

            ctx.save();
            ctx.translate(-60*s, 20*s);
            ctx.rotate(leftArmRot);
            ctx.beginPath();
            ctx.ellipse(0, 0, 20*s, 50*s, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();

            ctx.save();
            ctx.translate(60*s, 20*s);
            ctx.rotate(rightArmRot);
            ctx.beginPath();
            ctx.ellipse(0, 0, 20*s, 50*s, 0, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
        }

        let lastTypingTime = 0;
        function playTypeSound() {
            lastTypingTime = Date.now();
        }

        // --- Particles ---
        let particles = [];
        function createParticle(x, y, text) {
            particles.push({
                x: x, y: y, text: text,
                vx: (Math.random() - 0.5) * 5,
                vy: -5 - Math.random() * 5,
                life: 1.0
            });
        }

        function triggerFeedback(text, x, y, color) {
            const el = document.createElement('div');
            el.innerText = text;
            el.style.position = 'absolute';
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.color = color;
            el.style.fontWeight = 'bold';
            el.style.fontSize = '24px';
            el.style.pointerEvents = 'none';
            el.style.transition = 'all 1s ease-out';
            el.style.zIndex = 100;
            document.body.appendChild(el);

            setTimeout(() => {
                el.style.transform = 'translateY(-50px)';
                el.style.opacity = 0;
            }, 50);

            setTimeout(() => el.remove(), 1000);
        }

        function updateAndDrawParticles(ctx) {
            ctx.font = "30px Arial";
            for (let i = particles.length - 1; i >= 0; i--) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life -= 0.02;
                p.vy += 0.2; // Gravity

                ctx.globalAlpha = p.life;
                ctx.fillText(p.text, p.x, p.y);
                ctx.globalAlpha = 1.0;

                if (p.life <= 0) particles.splice(i, 1);
            }
        }

        function gameLoop(timestamp) {
            if (gameState !== 'PLAYING') return;

            let dt = timestamp - lastTime;
            lastTime = timestamp;

            update(dt);
            draw(ctx);
            requestAnimationFrame(gameLoop);
        }

    </script>
</body>
</html>